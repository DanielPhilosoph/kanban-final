(()=>{const t="http://json-bins.herokuapp.com/bin/614af3924021ac0e6c080cb3";let e,n,o="",a=document.querySelector("#search"),s=new Set,r=document.querySelector("#error-label"),i=document.querySelector("#context-menu"),c=!1,d=document.querySelector("#submit-add-to-do"),l=document.querySelector("#submit-add-in-progress"),u=document.querySelector("#submit-add-done"),f=document.querySelector("#save-btn"),v=document.querySelector("#load-btn");function m(t){switch(t.target.id){case"submit-add-to-do":inputValue=w("add-to-do-task"),q(inputValue,"todo",0,!0);break;case"submit-add-in-progress":inputValue=w("add-in-progress-task"),q(inputValue,"in-progress",0,!0);break;case"submit-add-done":inputValue=w("add-done-task"),q(inputValue,"done",0,!0)}x(a.value)}function p(t,e,n){let o=["todo","in-progress","done"];for(let a of n)a===n[e]&&q(t.textContent,o[e])}function g(t){let o=t.target,s=o.textContent;if(D(!1),c=!1,""===s)return D(!0,"Error: Empty task is not valid"),void(o.textContent=n);if(s!=n){const t=A(),o=t[e.dataset.section];let r=o.indexOf(n);o[r]=s,n=s,localStorage.setItem("tasks",JSON.stringify(t)),x(a.textContent)}}function y(t){t.target.offsetParent==i&&"Delete"===t.target.dataset.type&&confirm("Are you sure you want to delete "+n+" task?")&&(V(),x(a.value)),i.classList.remove("visible"),document.removeEventListener("click",y)}function k(t){t.target.classList.add("droppable-hovered")}function L(t){t.target.classList.remove("droppable-hovered")}function S(t){let o=t.target;o.classList.remove("droppable-hovered");let s=A()[e.dataset.section].indexOf(n);V(),function(t,n,o){n.dataset.section===e.dataset.section&&0!==t&&o<t?q(e.textContent,n.dataset.section,t-1):q(e.textContent,n.dataset.section,n.dataset.drop_div)}(parseInt(o.dataset.drop_div),o,s),x(a.textContent),D(!1)}function b(t){I(document.querySelector(".loader"),t)}function h(t,e=""){return!(null!=t&&!t.ok)||(D(!0,e+"Error! => "+t.status+" "+t.statusText),!1)}function E(t,e=[],n=[],o={},a={}){const s=document.createElement(t);for(const t of e)s.append(t);for(const t of n)s.classList.add(t);for(const t in o)s.setAttribute(t,o[t]);for(const[t,e]of Object.entries(a))s.addEventListener(t,e,!0);return s}function x(t){let e=["#div-to-do-tasks","#div-in-progress-tasks","#div-done-tasks"];for(let n of e){let e=document.querySelector(n);e.innerHTML="",e.append(N(t,e.dataset.section,[e.dataset.section+"-tasks"]))}document.querySelector("#add-to-do-task").value="",document.querySelector("#add-in-progress-task").value="",document.querySelector("#add-done-task").value=""}function C(t){if(t){let t=document.querySelector("body"),e=[];for(let t=0;t<4;t++)e.push(E("div"));let n=E("div",e,["loader"]);I(n,window.event),t.append(n)}else document.querySelector(".loader").remove()}function q(t,e,n=0,o=!1){const a=A(),s=a[e];""!==t?(0===n?s.unshift(t):s.splice(n,0,t),localStorage.setItem("tasks",JSON.stringify(a)),D(o,"Task was added succesfully","notification")):D(o,"Add failed, task is empty.")}function w(t){let e=document.querySelector("#"+t),n=e.value;return e.value="",n}function I(t,e){const{clientX:n,clientY:o}=e;t.style.top=`${o}px`,t.style.left=`${n}px`}function O(){return{drop:S,dragenter:k,dragleave:L}}function T(t,e){return{"data-section":t,tabIndex:e,draggable:!0}}function j(t){""!==t?(null!=e&&J(e),e=t,n=e.textContent,e.classList.contains("selected")||e.classList.add("selected")):J(e)}function J(t,e){t.classList.contains("selected")&&t.classList.remove("selected")}function N(t,e,r){const d=A();let l=[],u=0,f=t.toLowerCase();for(let t of d[e])t.toLowerCase().includes(f)&&(l.push(E("div",[],["droppable-div"],{"data-section":e,"data-drop_div":u},O())),l.push(E("li",[t],["task"],T(e,u),{keydown:t=>{!function(t){s.add(t.keyCode);let e=[49,50,51];for(let n=0;n<e.length;n++)if(t.altKey&&s.has(e[n])){t.preventDefault();let o=t.target;V(o.textContent),p(o,n,e),x(a.textContent)}s.has(8)&&!1===c&&confirm("Are you sure you want to delete "+n+" task?")&&(V(),x(a.value)),s.clear()}(t)},contextmenu:t=>{!function(t){t.preventDefault(),j(t.target),I(i,t),i.classList.add("visible"),document.addEventListener("click",y)}(t)},click:t=>{!function(t){j(t.target)}(t)},dblclick:t=>{!function(t){let e=t.target;j(t.target),t.preventDefault(),c=!0,e.contentEditable=!0,o=e.textContent,e.addEventListener("blur",g,!0),e.focus()}(t)},dragstart:t=>{!function(t){j(t.target),t.target.style.opacity=.9}(t)},dragend:t=>{!function(t){t.target.style.opacity=""}(t)}})),u++);return l.push(E("div",[],["droppable-div"],{"data-section":e,"data-drop_div":u},O())),E("ul",l,[...r],{"data-section":e})}function V(t=n){const o=A();let a=o[e.dataset.section].indexOf(t);-1!==a&&o[e.dataset.section].splice(a,1),localStorage.setItem("tasks",JSON.stringify(o))}function A(){return JSON.parse(localStorage.getItem("tasks"))}function D(t,e="",n="error"){r.textContent=e,r.classList.contains("error")?"error"!=n&&_("notification","error"):"error"==n&&_("error","notification"),r.classList.contains("hidden")?t&&_("visible","hidden"):t||_("hidden","visible")}function _(t,e){r.classList.remove(e),r.classList.add(t)}d.addEventListener("click",m),l.addEventListener("click",m),u.addEventListener("click",m),f.addEventListener("click",(async function(){await async function(){const e=localStorage.getItem("tasks");C(!0),document.addEventListener("mousemove",b);const n=await fetch(t,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({tasks:e})});document.removeEventListener("mousemove",b),C(!1),h(n,"Server")&&D(!0,"Tasks information was saved successfully!","notification")}(),x(a.value)})),v.addEventListener("click",(async function(){await async function(){C(!0),document.addEventListener("mousemove",b);const e=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(document.removeEventListener("mousemove",b),C(!1),h(e,"Loud")){let t=await e.json();localStorage.clear(),localStorage.setItem("tasks",t.tasks),D(!0,"Tasks Loaded Succesfully","notification")}}(),x(a.value)})),a.addEventListener("keyup",(function(t){"search"===t.target.id&&(x(document.getElementById("search").value),D(!1))})),document.addEventListener("click",(function(t){null!=e&&t.target!=e&&j("")})),document.addEventListener("dragover",(function(t){t.preventDefault()})),null==localStorage.getItem("tasks")&&localStorage.setItem("tasks",JSON.stringify({todo:[],"in-progress":[],done:[]})),x(a.value)})();